---
description: Правила разработки для Flutter мобильного проекта
alwaysApply: true
globs:
  - "**/*.dart"
---

# Cursor Rules для Flutter мобильного проекта

## Общие принципы

- Всегда отвечай на русском языке
- Следуй принципам SOLID и KISS
- Не добавляй комментарии (ни //, ни /* */, ни #)
- Удаляй неиспользуемый код
- Приоритет чистому, эффективному и поддерживаемому коду
- Следуй лучшим практикам Flutter и Dart

## Структура проекта

- Используй простую структуру: `lib/screens/`, `lib/widgets/`, `lib/services/`, `lib/models/`
- Храни каждый экран в отдельном файле
- Выноси переиспользуемые виджеты в `lib/widgets/`
- Храни сервисы (например, для работы с SharedPreferences) в `lib/services/`
- Используй константы для строк, цветов, размеров в отдельных файлах

## Стиль кода

- Используй `const` конструкторы везде, где возможно
- Предпочитай `final` вместо `var`
- Используй named parameters для функций с более чем 2 параметрами
- Используй `late final` вместо nullable, когда значение точно будет инициализировано
- Избегай `dynamic`, используй явные типы или `Object?`
- Используй `?.` и `??` для безопасной работы с nullable

## Виджеты

- Разбивай большие виджеты на маленькие переиспользуемые компоненты
- Используй `StatelessWidget` когда возможно, `StatefulWidget` только при необходимости состояния
- Используй `const` конструкторы для виджетов без состояния
- Избегай создания виджетов в build методах, выноси их в отдельные методы или классы

## State Management

- Используй `setState` для локального состояния
- Для простого глобального состояния (например, статус подписки) можно использовать простой сервис или Provider
- Избегай сложных state management решений без необходимости

## Производительность

- Используй `ListView.builder` вместо `ListView` для длинных списков
- Используй `const` виджеты для уменьшения перестроек
- Избегай создания объектов в build методах

## Асинхронность

- Используй `async/await` вместо `.then()`
- Обрабатывай ошибки с помощью `try-catch`
- Не забывай проверять `mounted` перед `setState` в асинхронных операциях

## Навигация

- Используй простую навигацию через `Navigator.push` и `Navigator.pushReplacement`
- Передавай данные через конструкторы
- Используй `Navigator.pushReplacement` для замены экрана (например, после онбординга)

## Работа с данными

- Используй `shared_preferences` для сохранения простых данных (статус подписки, завершен ли онбординг)
- Создай сервис для работы с SharedPreferences, не обращайся напрямую
- Используй простые модели данных без сложной сериализации

## Обработка ошибок

- Обрабатывай ошибки с помощью `try-catch`
- Показывай понятные сообщения об ошибках пользователю
- Используй `debugPrint()` для логирования ошибок

## Мобильная специфика

- Учитывай разные размеры экранов, используй `MediaQuery` или `LayoutBuilder`
- Используй `SafeArea` для избежания системных областей
- Используй `SingleChildScrollView` если контент может не поместиться на экран

## Зависимости

- Минимизируй количество зависимостей
- Используй только необходимые пакеты (например, `shared_preferences` для сохранения данных)
- Проверяй совместимость зависимостей

## Форматирование и линтинг

- Используй `dart format` для форматирования кода (аналог Prettier в React)
- Используй `flutter analyze` для проверки кода (аналог ESLint в React)
- Форматирование и сортировка импортов происходят автоматически при сохранении (настроено в `.vscode/settings.json`)
- Импорты автоматически сортируются: dart, flutter, пакеты, относительные
- Следуй правилам из `analysis_options.yaml`
- Используй 2 пробела для отступов
- Используй trailing commas для лучших diffs
- Максимальная длина строки: 80 символов

## Именование

- Используй `lowerCamelCase` для переменных, функций, параметров
- Используй `UpperCamelCase` для классов, типов, enum значений
- Используй `lowercase_with_underscores` для файлов
- Используй `SCREAMING_CAPS` для констант
- Используй префикс `_` для приватных членов

## Импорты

- Импорты автоматически сортируются при сохранении
- Порядок: dart, flutter, пакеты, относительные
- Используй относительные импорты для файлов в том же пакете

## Что НЕ делать

- Не используй `print()`, используй `debugPrint()`
- Не создавай виджеты в циклах без keys
- Не используй `setState` в build методах
- Не создавай большие виджеты в одном файле
- Не игнорируй предупреждения линтера без веской причины
- Не используй `!` для force unwrap без проверки
- Не хардкодь значения, используй константы

## Когда создавать новые файлы

- Виджет больше 100 строк - вынеси в отдельный файл
- Логика, которая может быть переиспользована - отдельный класс/функция
- Модели данных - отдельные файлы
- Сервисы - отдельные файлы
- Константы - отдельный файл

## Приоритеты

1. Читаемость и поддерживаемость кода
2. Простота реализации
3. Соответствие Flutter best practices
4. Минимизация зависимостей
